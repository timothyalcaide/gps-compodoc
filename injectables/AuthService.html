<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>gps documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">gps documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >AuthService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/auth/auth.service.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_isAuthenticated$" >_isAuthenticated$</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#_user$" >_user$</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#AUTH_STORAGE_ITEMS" >AUTH_STORAGE_ITEMS</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#canActivate$" >canActivate$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#isAuthenticated$" >isAuthenticated$</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#isDoneLoading$" >isDoneLoading$</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#onDestroySubject$" >onDestroySubject$</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#saveUser" >saveUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#user$" >user$</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#emptyAuthStorage" >emptyAuthStorage</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#emptyUser" >emptyUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#hasValidRefreshToken" >hasValidRefreshToken</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#initAuth" >initAuth</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#listenOAuthEvents" >listenOAuthEvents</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#listenSessionEnd" >listenSessionEnd</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#loadUser" >loadUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#login" >login</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#loginFromSSO" >loginFromSSO</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#logout" >logout</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#ngOnDestroy" >ngOnDestroy</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#successfulLogin" >successfulLogin</a>
                            </li>
                        </ul>
                    </td>
                </tr>





                    <tr>
                        <td class="col-md-4">
                            <h6><b>Accessors</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                    <a href="#userSessionStorage" >userSessionStorage</a>
                                </li>
                                <li>
                                    <a href="#clientId" >clientId</a>
                                </li>
                                <li>
                                    <a href="#redirectUri" >redirectUri</a>
                                </li>
                                <li>
                                    <a href="#isAuthenticated" >isAuthenticated</a>
                                </li>
                                <li>
                                    <a href="#user" >user</a>
                                </li>
                                <li>
                                    <a href="#hasEmail" >hasEmail</a>
                                </li>
                                <li>
                                    <a href="#email" >email</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(document: Document, context: <a href="../injectables/ApplicationContext.html" target="_self">ApplicationContext</a>, hroadsClient: <a href="../injectables/HroadsClient.html" target="_self">HroadsClient</a>, oauthService: <a href="../injectables/AuthService.html" target="_self">OAuthService</a>, router: <a href="https://angular.io/api/router/Router" target="_blank">Router</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="145" class="link-to-prism">src/app/core/services/auth/auth.service.ts:145</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>document</td>
                                                  
                                                        <td>
                                                                    <code>Document</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>context</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ApplicationContext.html" target="_self" >ApplicationContext</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>hroadsClient</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/HroadsClient.html" target="_self" >HroadsClient</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>oauthService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/AuthService.html" target="_self" >OAuthService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>router</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://angular.io/api/router/Router" target="_blank" >Router</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="emptyAuthStorage"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>emptyAuthStorage</b></span>
                        <a href="#emptyAuthStorage"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>emptyAuthStorage()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="317"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:317</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Remove all the related items in the authentication storage (local storage or session storage
according to the configuration)</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="emptyUser"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>emptyUser</b></span>
                        <a href="#emptyUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>emptyUser()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="378"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:378</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasValidRefreshToken"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>hasValidRefreshToken</b></span>
                        <a href="#hasValidRefreshToken"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasValidRefreshToken()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="385"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:385</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Check if the refresh token is present and not expired</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="initAuth"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>initAuth</b></span>
                        <a href="#initAuth"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>initAuth()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="198"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:198</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Initialise OAuth module</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>    <code>Observable&lt;void&gt;</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listenOAuthEvents"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>listenOAuthEvents</b></span>
                        <a href="#listenOAuthEvents"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>listenOAuthEvents()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="330"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:330</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Update authentication status on OAuth event</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listenSessionEnd"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>listenSessionEnd</b></span>
                        <a href="#listenSessionEnd"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>listenSessionEnd()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="343"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:343</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Empty user when session ends</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loadUser"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>loadUser</b></span>
                        <a href="#loadUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>loadUser(userInfo: <a href="../classes/User.html" target="_self">UserInfo</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="374"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:374</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userInfo</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >UserInfo</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="login"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>login</b></span>
                        <a href="#login"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>login(path: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, clientId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, application?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="257"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:257</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>path</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>clientId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>application</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Observable&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loginFromSSO"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>loginFromSSO</b></span>
                        <a href="#loginFromSSO"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>loginFromSSO(user: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="296"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:296</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Log a user which has been logged from the Hroads SSO</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>The user</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>token</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>The token</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Observable&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>An observable emitting true if the user is successfully logged in, false otherwise</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logout"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>logout</b></span>
                        <a href="#logout"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>logout(noRedirectToLogoutUrl: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="308"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:308</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>noRedirectToLogoutUrl</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="ngOnDestroy"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>ngOnDestroy</b></span>
                        <a href="#ngOnDestroy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>ngOnDestroy()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="190"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:190</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="successfulLogin"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>successfulLogin</b></span>
                        <a href="#successfulLogin"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>successfulLogin()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="358"
                            class="link-to-prism">src/app/core/services/auth/auth.service.ts:358</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_isAuthenticated$"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>_isAuthenticated$</b></span>
                        <a href="#_isAuthenticated$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>BehaviorSubject&lt;boolean&gt;</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new BehaviorSubject&lt;boolean&gt;(false)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="67" class="link-to-prism">src/app/core/services/auth/auth.service.ts:67</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Whether the user is authenticated or not</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_user$"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>_user$</b></span>
                        <a href="#_user$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/User.html" target="_self" >BehaviorSubject&lt;User&gt;</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new BehaviorSubject&lt;User&gt;(null)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="72" class="link-to-prism">src/app/core/services/auth/auth.service.ts:72</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>The authenticated user</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="AUTH_STORAGE_ITEMS"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>AUTH_STORAGE_ITEMS</b></span>
                        <a href="#AUTH_STORAGE_ITEMS"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Array&lt;string&gt;</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>[
    &#x27;access_token&#x27;,
    &#x27;access_token_stored_at&#x27;,
    &#x27;expires_at&#x27;,
    &#x27;granted_scopes&#x27;,
    &#x27;id_token&#x27;,
    &#x27;id_token_claims_obj&#x27;,
    &#x27;id_token_expires_at&#x27;,
    &#x27;id_token_stored_at&#x27;,
    &#x27;nonce&#x27;,
    &#x27;PKCE_verifier&#x27;,
    &#x27;refresh_token&#x27;,
    &#x27;session_state&#x27;
  ]</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="74" class="link-to-prism">src/app/core/services/auth/auth.service.ts:74</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="canActivate$"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>canActivate$</b></span>
                        <a href="#canActivate$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Observable&lt;boolean&gt;</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>of(false)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="48" class="link-to-prism">src/app/core/services/auth/auth.service.ts:48</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Used for authentication guards
Waits for the service to finish loading and check that the user is authenticated</p>
<p>Waiting for the service loading is required to allow direct access to a protected
authenticated. This prevents the following situation:</p>
<ul>
<li>The user access the protected page: isAuthenticated is false as the initial tryLogin has not
 been done</li>
<li>So, the application redirects to login page</li>
<li>Back to the application after login, isAuthenticated is true (token_received event)</li>
<li>The successful login callback redirects to the protected page and removes it from local
 storage</li>
<li>Meanwhile, the service is still initializing (restarted when coming back to the application
 after login). When it loads the access token, it executes the successful login callback</li>
<li>There is no redirectUri in local storage so it redirects to the home page while the user
 wanted to access the protected page</li>
</ul>
<p>Inspired from <a href="https://github.com/jeroenheijmans/sample-angular-oauth2-oidc-with-auth-guards/">https://github.com/jeroenheijmans/sample-angular-oauth2-oidc-with-auth-guards/</a></p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isAuthenticated$"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>isAuthenticated$</b></span>
                        <a href="#isAuthenticated$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Observable&lt;boolean&gt;</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="55" class="link-to-prism">src/app/core/services/auth/auth.service.ts:55</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>An observable emitting whether the user is authenticated or not
It has to be directly used when the component or service has to be notified when the
authentication state changes. Otherwise, use the getter isAuthenticated</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isDoneLoading$"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>isDoneLoading$</b></span>
                        <a href="#isDoneLoading$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>BehaviorSubject&lt;boolean&gt;</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new BehaviorSubject&lt;boolean&gt;(false)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="94" class="link-to-prism">src/app/core/services/auth/auth.service.ts:94</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Indicates if the Authentication Service is fully loaded or not</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="onDestroySubject$"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>onDestroySubject$</b></span>
                        <a href="#onDestroySubject$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Subject&lt;void&gt;</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Subject&lt;void&gt;()</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="89" class="link-to-prism">src/app/core/services/auth/auth.service.ts:89</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="saveUser"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>saveUser</b></span>
                        <a href="#saveUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="96" class="link-to-prism">src/app/core/services/auth/auth.service.ts:96</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="user$"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>user$</b></span>
                        <a href="#user$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/User.html" target="_self" >Observable&lt;User&gt;</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="62" class="link-to-prism">src/app/core/services/auth/auth.service.ts:62</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>An observable emitting the authenticated user
It has to be directly used when the component or service has to be notified when the
user changes. Otherwise, use the getter user</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
</section>

            <section>
    <h3 id="accessors">
        Accessors
    </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="userSessionStorage"></a>
                        <span class="name"><b>userSessionStorage</b><a href="#userSessionStorage"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>userSessionStorage()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="98" class="link-to-prism">src/app/core/services/auth/auth.service.ts:98</a></div>
                                </td>
                            </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>set</b><code>userSessionStorage(user: <a href="../classes/User.html" target="_self">User</a>)</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="108" class="link-to-prism">src/app/core/services/auth/auth.service.ts:108</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">

                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <table class="params">
                                            <thead>
                                                <tr>
                                                    <td>Name</td>
                                                        <td>Type</td>
                                                    <td>Optional</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                    <tr>
                                                            <td>user</td>
                                                    
                                                            <td>
                                                                            <code><a href="../classes/User.html" target="_self" >User</a></code>
                                                            </td>
                                                    
                                                        <td>
                                                                No
                                                        </td>
                                                        
                                                    </tr>
                                            </tbody>
                                        </table>
                                </div>
                                <div>
                                </div>
                                <div class="io-description">
                                    <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                                </div>
                        </td>
                    </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="clientId"></a>
                        <span class="name"><b>clientId</b><a href="#clientId"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>clientId()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="112" class="link-to-prism">src/app/core/services/auth/auth.service.ts:112</a></div>
                                </td>
                            </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="redirectUri"></a>
                        <span class="name"><b>redirectUri</b><a href="#redirectUri"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>redirectUri()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="116" class="link-to-prism">src/app/core/services/auth/auth.service.ts:116</a></div>
                                </td>
                            </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="isAuthenticated"></a>
                        <span class="name"><b>isAuthenticated</b><a href="#isAuthenticated"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>isAuthenticated()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="120" class="link-to-prism">src/app/core/services/auth/auth.service.ts:120</a></div>
                                </td>
                            </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="user"></a>
                        <span class="name"><b>user</b><a href="#user"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>user()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="124" class="link-to-prism">src/app/core/services/auth/auth.service.ts:124</a></div>
                                </td>
                            </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="hasEmail"></a>
                        <span class="name"><b>hasEmail</b><a href="#hasEmail"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>hasEmail()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="131" class="link-to-prism">src/app/core/services/auth/auth.service.ts:131</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Check if we have the email of the user</p>
</div>

                                <div class="io-description">
                                    <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                </div>
                        </td>
                    </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="email"></a>
                        <span class="name"><b>email</b><a href="#email"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>email()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="141" class="link-to-prism">src/app/core/services/auth/auth.service.ts:141</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Return the email of the current user
If it&#39;s authenticated, return the email of the authenticated user
If the user already give it&#39;s email, return it
Else, return null</p>
</div>

                                <div class="io-description">
                                    <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                </div>
                        </td>
                    </tr>

            </tbody>
        </table>
</section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { DOCUMENT } from &#x27;@angular/common&#x27;;
import { Inject, Injectable, OnDestroy } from &#x27;@angular/core&#x27;;
import { Router } from &#x27;@angular/router&#x27;;
import {
  REDIRECT_URI_CONFIG,
  SILENT_REFRESH_REDIRECT_URI_CONFIG
} from &#x27;@configs/redirect-uri.config&#x27;;
import { SAVE_USER_CONTEXT_CONFIG } from &#x27;@configs/save-user-context.config&#x27;;
import { SSO_AUTHENTICATION_CONFIG } from &#x27;@configs/sso-authentication.config&#x27;;
import { authStorageFactory } from &#x27;@core/modules/auth/auth-storage&#x27;;
import { AppRouteUrls } from &#x27;@core/routing/app/route-urls&#x27;;
import { ApplicationContext, HroadsClient } from &#x27;@core/services&#x27;;
import { ApplicationName } from &#x27;@models/context/application-name&#x27;;
import { ErrorCodes } from &#x27;@models/error-codes/error-codes&#x27;;
import { IdentityClaims } from &#x27;@models/identity-claims/identity-claims&#x27;;
import { User } from &#x27;@models/user/user&#x27;;
import {
  NullValidationHandler,
  OAuthEvent,
  OAuthService,
  OAuthStorage,
  UserInfo
} from &#x27;angular-oauth2-oidc&#x27;;
import { BehaviorSubject, from, Observable, of, Subject } from &#x27;rxjs&#x27;;
import { catchError, filter, map, mapTo, switchMap, takeUntil, tap } from &#x27;rxjs/operators&#x27;;

@Injectable({ providedIn: &#x27;root&#x27; })
export class AuthService implements OnDestroy {
  /**
   * Used for authentication guards
   * Waits for the service to finish loading and check that the user is authenticated
   *
   * Waiting for the service loading is required to allow direct access to a protected
   * authenticated. This prevents the following situation:
   * - The user access the protected page: isAuthenticated is false as the initial tryLogin has not
   *    been done
   * - So, the application redirects to login page
   * - Back to the application after login, isAuthenticated is true (token_received event)
   * - The successful login callback redirects to the protected page and removes it from local
   *    storage
   * - Meanwhile, the service is still initializing (restarted when coming back to the application
   *    after login). When it loads the access token, it executes the successful login callback
   * - There is no redirectUri in local storage so it redirects to the home page while the user
   *    wanted to access the protected page
   *
   * Inspired from https://github.com/jeroenheijmans/sample-angular-oauth2-oidc-with-auth-guards/
   */
  public canActivate$: Observable&lt;boolean&gt; &#x3D; of(false);

  /**
   * An observable emitting whether the user is authenticated or not
   * It has to be directly used when the component or service has to be notified when the
   * authentication state changes. Otherwise, use the getter isAuthenticated
   */
  public readonly isAuthenticated$: Observable&lt;boolean&gt;;

  /**
   * An observable emitting the authenticated user
   * It has to be directly used when the component or service has to be notified when the
   * user changes. Otherwise, use the getter user
   */
  public readonly user$: Observable&lt;User&gt;;

  /**
   * Whether the user is authenticated or not
   */
  private _isAuthenticated$: BehaviorSubject&lt;boolean&gt; &#x3D; new BehaviorSubject&lt;boolean&gt;(false);

  /**
   * The authenticated user
   */
  private _user$: BehaviorSubject&lt;User&gt; &#x3D; new BehaviorSubject&lt;User&gt;(null);

  private readonly AUTH_STORAGE_ITEMS: Array&lt;string&gt; &#x3D; [
    &#x27;access_token&#x27;,
    &#x27;access_token_stored_at&#x27;,
    &#x27;expires_at&#x27;,
    &#x27;granted_scopes&#x27;,
    &#x27;id_token&#x27;,
    &#x27;id_token_claims_obj&#x27;,
    &#x27;id_token_expires_at&#x27;,
    &#x27;id_token_stored_at&#x27;,
    &#x27;nonce&#x27;,
    &#x27;PKCE_verifier&#x27;,
    &#x27;refresh_token&#x27;,
    &#x27;session_state&#x27;
  ];

  private onDestroySubject$: Subject&lt;void&gt; &#x3D; new Subject&lt;void&gt;();

  /**
   * Indicates if the Authentication Service is fully loaded or not
   */
  private isDoneLoading$: BehaviorSubject&lt;boolean&gt; &#x3D; new BehaviorSubject&lt;boolean&gt;(false);

  private saveUser: boolean;

  public get userSessionStorage(): User {
    if (this.isAuthenticated &amp;&amp; this.user) return this.user;

    const userSessionStorageJSON &#x3D; sessionStorage.getItem(&#x27;user&#x27;);

    if (!userSessionStorageJSON) return null;

    return User.buildFromSessionStorage(JSON.parse(userSessionStorageJSON));
  }

  public set userSessionStorage(user: User) {
    if (this.saveUser) sessionStorage.setItem(&#x27;user&#x27;, JSON.stringify(user.toUserSessionStorage()));
  }

  public get clientId(): string {
    return this.oauthService.clientId;
  }

  public get redirectUri(): string {
    return this.oauthService.redirectUri;
  }

  public get isAuthenticated(): boolean {
    return this._isAuthenticated$.value;
  }

  public get user(): User {
    return this._user$.value;
  }

  /**
   * Check if we have the email of the user
   */
  public get hasEmail(): boolean {
    return !!this.email;
  }

  /**
   * Return the email of the current user
   * If it&#x27;s authenticated, return the email of the authenticated user
   * If the user already give it&#x27;s email, return it
   * Else, return null
   */
  public get email(): string {
    if (this.isAuthenticated &amp;&amp; this.user?.email) return this.user.email;

    return this.userSessionStorage?.email || null;
  }

  constructor(
    @Inject(DOCUMENT) private document: Document,
    private context: ApplicationContext,
    private hroadsClient: HroadsClient,
    private oauthService: OAuthService,
    private router: Router
  ) {
    this.isAuthenticated$ &#x3D; this._isAuthenticated$.asObservable();
    this.user$ &#x3D; this._user$.asObservable();

    this.saveUser &#x3D; SAVE_USER_CONTEXT_CONFIG(this.context.product);

    /**
     * Ignore Auth Service initialisation for dispatch domain so there is no nonce/state validation
     * error as the nonce and the state are stored in the application domain local storage and so
     * not shared with dispatch domain
     */
    if (!this.context.applicationName || this.context.applicationName &#x3D;&#x3D;&#x3D; ApplicationName.Dispatch)
      return;

    this.canActivate$ &#x3D; this.isDoneLoading$.pipe(
      filter((isDoneLoading: boolean) &#x3D;&gt; isDoneLoading),
      map(_ &#x3D;&gt; this.isAuthenticated)
    );

    // Update redirect uri for UAA
    this.oauthService.redirectUri &#x3D; REDIRECT_URI_CONFIG(
      this.context.product,
      this.context.applicationName
    );
    this.oauthService.silentRefreshRedirectUri &#x3D; SILENT_REFRESH_REDIRECT_URI_CONFIG(
      this.context.product,
      this.context.applicationName
    );

    // Listen OAuth events
    this.listenOAuthEvents();
    this.listenSessionEnd();

    // Start automatic silent refresh that refreshes the token before it expires
    this.oauthService.setupAutomaticSilentRefresh();
  }

  public ngOnDestroy(): void {
    this.onDestroySubject$.next();
    this.onDestroySubject$.complete();
  }

  /**
   * Initialise OAuth module
   */
  public initAuth(): Observable&lt;void&gt; {
    /**
     * Ignore Auth Service initialisation for dispatch domain so there is no nonce/state validation
     * error as the nonce and the state are stored in the application domain local storage and so
     * not shared with dispatch domain
     */
    if (!this.context.applicationName || this.context.applicationName &#x3D;&#x3D;&#x3D; ApplicationName.Dispatch)
      return of(null);

    /**
     * Needed as Keycloak does not return at_hash claim in the access token in Code flow. It
     * prevents the application from crashing.
     * https://ordina-jworks.github.io/security/2019/08/22/Securing-Web-Applications-With-Keycloak.html
     */
    this.oauthService.tokenValidationHandler &#x3D; new NullValidationHandler();

    /**
     * Load the Keycloak endpoints configuration (discovery document) and initiate login so if user
     * is already logged, the session is loaded.
     */
    return from(this.oauthService.loadDiscoveryDocumentAndTryLogin()).pipe(
      switchMap(() &#x3D;&gt; {
        if (this.oauthService.hasValidAccessToken()) return of(this.successfulLogin());

        if (this.oauthService.getRefreshToken()) {
          // If login has failed (i.e. token expired), try to refresh the token if valid
          if (this.hasValidRefreshToken()) {
            return from(this.oauthService.refreshToken()).pipe(
              catchError(() &#x3D;&gt; {
                // Refresh token has failed so it empties all the previous authentication state
                this.emptyAuthStorage();
                this.emptyUser();
                this.isDoneLoading$.next(true);

                return null;
              }),
              // Refresh token has succeeded
              map(() &#x3D;&gt; this.successfulLogin())
            );
          }

          /**
           * Access and refresh token are expired. So they are deleted to prevent a white page caused
           * by Adventure service refusing the expired access token.
           */
          this.emptyAuthStorage();
        }

        // Login failed and refresh token is missing
        this.isDoneLoading$.next(true);
        this.emptyUser();

        return of(null);
      })
    );
  }

  /* -- LOGIN -- */

  public login(path: string, clientId: string, application?: string): Observable&lt;void&gt; {
    // Remove the initial slash in the path if present
    const returnUrl: string &#x3D; path[0] &#x3D;&#x3D;&#x3D; &#x27;/&#x27; ? path.slice(1) : path;

    // Indicate to keycloak the from app and the from uri
    if (application) {
      this.oauthService.customQueryParams &#x3D; {
        from_app: application
      };
    }

    // Change clientId
    if (clientId) this.oauthService.clientId &#x3D; clientId;

    localStorage.setItem(&#x27;returnUrl&#x27;, returnUrl);

    if (SSO_AUTHENTICATION_CONFIG(this.context.product)) {
      return this.hroadsClient.getSsoUrl().pipe(
        map(ssoUrl &#x3D;&gt; {
          this.document.defaultView.location.href &#x3D; ssoUrl;
        }),
        catchError((_: unknown) &#x3D;&gt;
          from(this.router.navigateByUrl(&#x60;/${AppRouteUrls.ERROR(ErrorCodes.ERROR_404)}&#x60;)).pipe(
            mapTo(null)
          )
        )
      );
    }

    return of(this.oauthService.initCodeFlow());
  }

  /**
   * Log a user which has been logged from the Hroads SSO
   *
   * @param user The user
   * @param token The token
   * @returns An observable emitting true if the user is successfully logged in, false otherwise
   */
  public loginFromSSO(user: string, token: string): Observable&lt;boolean&gt; {
    this.oauthService.oidc &#x3D; false;
    this.oauthService.responseType &#x3D; &#x27;&#x27;;

    return from(this.oauthService.fetchTokenUsingPasswordFlowAndLoadUserProfile(user, token)).pipe(
      tap((userInfo: UserInfo) &#x3D;&gt; userInfo &amp;&amp; this.loadUser(userInfo)),
      map(userInfo &#x3D;&gt; !!userInfo)
    );
  }

  /* -- LOGOUT -- */

  public logout(noRedirectToLogoutUrl: boolean &#x3D; false): void {
    this.emptyUser();
    this.oauthService.logOut(noRedirectToLogoutUrl);
  }

  /**
   * Remove all the related items in the authentication storage (local storage or session storage
   * according to the configuration)
   */
  public emptyAuthStorage(): void {
    const authStorage: OAuthStorage &#x3D; authStorageFactory();

    this.AUTH_STORAGE_ITEMS.forEach((item: string) &#x3D;&gt; {
      authStorage.removeItem(item);
    });
  }

  /* -- OAUTH EVENT LISTENERS --  */

  /**
   * Update authentication status on OAuth event
   */
  private listenOAuthEvents(): void {
    this.oauthService.events.pipe(takeUntil(this.onDestroySubject$)).subscribe(event &#x3D;&gt; {
      this._isAuthenticated$.next(this.oauthService.hasValidAccessToken());

      if (event.type &#x3D;&#x3D;&#x3D; &#x27;token_refresh_error&#x27;) {
        this.emptyAuthStorage();
      }
    });
  }

  /**
   * Empty user when session ends
   */
  private listenSessionEnd(): void {
    this.oauthService.events
      .pipe(
        filter(
          (event: OAuthEvent) &#x3D;&gt;
            event.type &#x3D;&#x3D;&#x3D; &#x27;session_terminated&#x27; || event.type &#x3D;&#x3D;&#x3D; &#x27;session_error&#x27;
        ),
        takeUntil(this.onDestroySubject$)
      )
      .subscribe(() &#x3D;&gt; {
        this._isAuthenticated$.next(false);
        this.emptyUser();
      });
  }

  private successfulLogin(): void {
    this.isDoneLoading$.next(true);

    this.loadUser(this.oauthService.getIdentityClaims() as UserInfo);

    // After login, redirect to the wanted URL
    const returnUrl: string &#x3D; localStorage.getItem(&#x27;returnUrl&#x27;);

    if (returnUrl) {
      localStorage.removeItem(&#x27;returnUrl&#x27;);
      this.document.defaultView.location.href +&#x3D; returnUrl;
    }
  }

  /* -- USER -- */

  private loadUser(userInfo: UserInfo): void {
    this._user$.next(User.fromIdentityClaims(userInfo as unknown as IdentityClaims));
  }

  private emptyUser(): void {
    this._user$.next(null);
  }

  /**
   * Check if the refresh token is present and not expired
   */
  private hasValidRefreshToken(): boolean {
    const refreshToken: string &#x3D; this.oauthService.getRefreshToken();

    if (!refreshToken) return false;

    const refreshTokenExpiry: number &#x3D; JSON.parse(atob(refreshToken.split(&#x27;.&#x27;)[1])).exp;

    return Math.floor(Date.now() / 1000) &lt; refreshTokenExpiry;
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'AuthService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
